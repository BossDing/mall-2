var allProductList=[];var tempList=[];function loadAllProduct(productList){allProductList=productList;if(allProductList==null||allProductList.length==0){$("._sku").addClass("disabled")}else{controlSpecBtn(allProductList,null,true,false)}}function clickSpecDetail(obj,bool){var self=$(obj);if(self.hasClass("disabled")){return false}else{self.addClass("selected").siblings().removeClass("selected")}$(".sel_spec_"+$(obj).attr("data-parent")).html("“"+$(obj).attr("title")+"”");self.append("<i></i>");var specList=$("._sku");var selSpecList=[];for(var i=0;i<specList.length;i++){if($(specList[i]).hasClass("selected")){selSpecList.push(specList[i])}}var tempProductList=[];var allRunCount=0;for(var j=0;j<allProductList.length;j++){var goodsSpec=allProductList[j].specVo;var count=0;for(var k=0;k<goodsSpec.length;k++){for(var i=0;i<selSpecList.length;i++){if(goodsSpec[k].goodsSpecDetail.specDetailId==$(selSpecList[i]).attr("data-value")){count=count-1+2;if(count==0){$(specList[i]).addClass("disabled")}else{$(specList[i]).removeClass("disabled")}}}}if(count>=selSpecList.length){if($("#allSpecLength").val()==count){location.href=allProductList[j].goodsInfoId+".html"}tempProductList.push(allProductList[j])}else{allRunCount+=1}}if(allRunCount==allProductList.length){$("._sku").removeClass("selected");self.addClass("selected");self.append("<i></i>");clickSpecDetail(self,false);bool=true}}function controlSpecBtn(tempProductList,obj,bool,checkRunAgain){var specList=$("._sku");var canSelSpec=[];for(var i=0;i<tempProductList.length;i++){var goodsSpec=tempProductList[i].specVo;for(var k=0;k<goodsSpec.length;k++){canSelSpec.push(goodsSpec[k].goodsSpecDetail.specDetailId)}}for(var i=0;i<specList.length;i++){var count=0;for(var k=0;k<canSelSpec.length;k++){if(canSelSpec[k]==$(specList[i]).attr("data-value")){count=count-1+2}}if(count==0){$(specList[i]).parent().remove()}else{$(specList[i]).removeClass("disabled")}}if(!bool&&obj!=null&&checkRunAgain){$(obj).removeClass("disabled");clickSpecDetail(obj,false)}}function loadChooseParam(){var params=$(".chooseParamId");var specList=$("._sku");if(params.length>0){for(var i=0;i<params.length;i++){for(var k=0;k<specList.length;k++){$(specList[k]).removeClass("disabled");if($(specList[k]).attr("data-value")==$(params[i]).val()){$(specList[k]).addClass("selected");$(specList[k]).addClass("disabled")}}}}}function myaccMul(arg1,arg2){if(arg1==null){return}if(arg2==null){return}var m=0,s1=arg1.toString(),s2=arg2.toString();try{m+=s1.split(".")[1].length}catch(e){}try{m+=s2.split(".")[1].length}catch(e){}return(Number(s1.replace(".",""))*Number(s2.replace(".",""))/Math.pow(10,m)).toFixed(3)}function loadGoodsMark(){$.get("../gmarket/"+$("#productId").val()+"-"+$("#brandId").val()+"-"+$("#catId").val()+".html",function(data){if(null==data||data.length<=0){$(".pro_market").append("<li><em>无</em>此商品暂无促销信息</li>")}else{var marketInfo={minPrice:Number.MAX_VALUE,codexType:"0",info:"<li><em class='sales_label'>无</em></li>"};var count=0;var num=0;var vip=$("#vip").val();var oldPrice=$("#oldPrice").val();var maxbuynum=0;for(var i=0;i<data.length;i++){var marketing=data[i];if(marketing.customerbuynum){if(maxbuynum==0){maxbuynum=marketing.customerbuynum}else{maxbuynum=marketing.customerbuynum<maxbuynum?maxbuynum:marketing.customerbuynum}}if(marketing.codexType==1){$(".pro_market").append("<li><em class='sales_label'>"+marketing.marketingName+"</em>");if(vip=="1"){$(".pro_market").append("<span class='promotion_info'>直降"+marketing.priceOffMarketing.offVipValue+"元</span><br/></li>")}else{$(".pro_market").append("<span class='promotion_info'>直降"+marketing.priceOffMarketing.offValue+"元</span><br/></li>")}}else{if(marketing.codexType==15){var labelInfo="<li><em class='sales_label'>"+marketing.marketingName+"</em>";if(marketing.preDiscountMarketings!=null&&marketing.preDiscountMarketings.length!=0){for(var j=0;j<marketing.preDiscountMarketings.length;j++){if($("#productId").val()==marketing.preDiscountMarketings[j].goodsId){var discountFlag=marketing.preDiscountMarketings[j].discountFlag;var price=0;if(vip=="0"){price=myaccMul(marketing.preDiscountMarketings[j].discountInfo,oldPrice).toString();labelInfo+="折扣："+marketing.preDiscountMarketings[j].discountInfo+"  "}else{if(vip=="1"){price=myaccMul(marketing.preDiscountMarketings[j].vipdiscountInfo,oldPrice).toString();labelInfo+="折扣："+marketing.preDiscountMarketings[j].vipdiscountInfo+"  "}}if(discountFlag=="1"){if(price.length-price.indexOf(".")+1>=2){price=price.substring(0,price.indexOf(".")+2)+"0"}}else{if(discountFlag=="2"){if(price.length-price.indexOf(".")+1>=1){price=price.substring(0,price.indexOf(".")+1)+"00"}}else{if(price.length-price.indexOf(".")+1>=3){price=price.substring(0,price.indexOf(".")+3)}}}if(num==0){if(marketInfo.minPrice>price){marketInfo.codexType=marketing.codexType;marketInfo.minPrice=price;marketInfo.info=labelInfo+"</li>";$(".price").hide();$(".cxyj").show();$(".cxj").show();$(".oldprice").html("￥"+oldPrice);$(".mark_price").html("￥"+price)
}}num++}}}}else{if(marketing.codexType==5){if(marketing.fullbuyReduceMarketings!=null&&marketing.fullbuyReduceMarketings.length!=0){for(var j=0;j<marketing.fullbuyReduceMarketings.length;j++){if(vip=="1"){$(".pro_market").append("<li><em class='sales_label'>"+marketing.marketingName+"</em>满"+marketing.fullbuyReduceMarketings[j].vipFullPrice+"减"+marketing.fullbuyReduceMarketings[j].vipReducePrice+"</li>")}else{if(vip=="0"){$(".pro_market").append("<li><em class='sales_label'>"+marketing.marketingName+"</em>满"+marketing.fullbuyReduceMarketings[j].fullPrice+"减"+marketing.fullbuyReduceMarketings[j].reducePrice+"</li>")}}}}}else{if(marketing.codexType==8){if(marketing.fullbuyDiscountMarketings!=null&&marketing.fullbuyDiscountMarketings.length!=0){for(var j=0;j<marketing.fullbuyDiscountMarketings.length;j++){if(vip=="1"){$(".pro_market").append("<li><em class='sales_label'>"+marketing.marketingName+"</em>满"+marketing.fullbuyDiscountMarketings[j].vipFullPrice+"打"+(marketing.fullbuyDiscountMarketings[j].vipFullbuyDiscount*10)+"折</li>")}else{if(vip=="0"){$(".pro_market").append("<li><em class='sales_label'>"+marketing.marketingName+"</em>满"+marketing.fullbuyDiscountMarketings[j].fullPrice+"打"+(marketing.fullbuyDiscountMarketings[j].fullbuyDiscount*10)+"折</li>")}}}}}else{if(marketing.codexType==10&&count==0){var labelInfo="<li><em class='sales_label'>"+marketing.marketingName+"</em>";var markPrice=0;$(".price").hide();$(".cxyj").show();$(".cxj").show();$("#priceflr").html("团&nbsp;购&nbsp;价：");if(vip=="0"){if(marketInfo.minPrice>marketing.groupon.grouponPrice){markPrice=marketing.groupon.grouponPrice.toFixed(2);marketInfo.codexType=marketing.codexType;marketInfo.minPrice=markPrice;marketInfo.info=labelInfo+"<span class='promotion_info'>享有团购价</span><br/></li>";$(".oldprice").html("¥ "+oldPrice);$(".mark_price").html("¥ "+markPrice)}}if(vip=="1"){if(marketInfo.minPrice>marketing.groupon.grouponVipPrice){markPrice=marketing.groupon.grouponVipPrice.toFixed(2);marketInfo.codexType=marketing.codexType;marketInfo.minPrice=markPrice;marketInfo.info=labelInfo+"<span class='promotion_info'>享有会员团购价</span><br/></li>";$(".oldprice").html("¥ "+oldPrice);$(".mark_price").html("¥ "+markPrice)}}count++}else{if(marketing.codexType==11){var labelInfo="<li><em class='sales_label'>"+marketing.marketingName+"</em>";$(".price").hide();$(".cxyj").show();$(".cxj").show();$("#priceflr").html("抢&nbsp;购&nbsp;价：");if(vip=="0"){if(marketInfo.minPrice>=marketing.rushs[0].rushPrice){var markPrice=marketing.rushs[0].rushPrice.toFixed(2);marketInfo.codexType=marketing.codexType;marketInfo.minPrice=markPrice;marketInfo.info=labelInfo+"<span class='promotion_info'>享有抢购价，限购"+marketing.rushs[0].rushLimitation+"件</span><br/></li>";$(".oldprice").html("¥ "+oldPrice);$(".mark_price").html("¥ "+markPrice)}}if(vip=="1"){if(marketInfo.minPrice>=marketing.rushs[0].rushVipPrice){var markPrice=marketing.rushs[0].rushVipPrice.toFixed(2);marketInfo.codexType=marketing.codexType;marketInfo.minPrice=markPrice;marketInfo.info=labelInfo+"<span class='promotion_info'>享有会员抢购价，限购"+marketing.rushs[0].rushLimitation+"件</span><br/></li>";$(".oldprice").html("¥ "+oldPrice);$(".mark_price").html("¥ "+markPrice)}}}else{if(marketing.codexType==12){if(vip=="1"){$(".pro_market").append("<li><span class='promotion_info'>支持"+marketing.vipShippingMoney+"免运费</span></li>")}else{if(vip=="0"){$(".pro_market").append("<li><span class='promotion_info'>支持"+marketing.shippingMoney+"免运费</span></li>")}}}}}}}}}}if(maxbuynum!=0){$("#buynum").val(maxbuynum)}if(marketInfo.codexType=="15"||marketInfo.codexType=="10"||marketInfo.codexType=="11"){$(".pro_market").append(marketInfo.info)}else{if($(".pro_market").html()==""){$(".pro_market").append(marketInfo.info)}}}})}function loadComment(pageNo,type){$(".comment_item_list").html("");$(".comment_pages").html("");var productId=$("#productId").val();var params="&productId="+productId;params+="&pageNo="+pageNo+"&pageSize=1";var haoCount=0;var zhongCount=0;var chaCount=0;$.get("../goods/queryProducCommentForDetail.html?type=0"+params,function(data){haoCount=data.rows;if(type==0){putPageComment(type,data)}$(".hao_count").text(haoCount)});$.get("../goods/queryProducCommentForDetail.html?type=1"+params,function(data){zhongCount=data.rows;if(type==1){putPageComment(type,data)}$(".zhong_count").text(zhongCount)});$.get("../goods/queryProducCommentForDetail.html?type=2"+params,function(data){chaCount=data.rows;if(type==2){putPageComment(type,data)}$(".cha_count").text(chaCount)})}$(function(){$(".num_minus").click(function(){var count=parseFloat($(".product_count").val());if(count>1){$(".product_count").val(parseFloat(count-parseFloat(1)))}});$(".num_plus").click(function(){var count=parseFloat($(".product_count").val());$(".product_count").val(parseFloat(count+parseFloat(1)))});$(".load_comment").keyup(function(){var count=$(".product_count").val();if(isNaN(count)){$(".product_count").val("1")}});var addCartNum=0;$(".add_cart").click(function(){$(".tip_text").html("库存不足!");
    var count=parseFloat($(".product_count").val());var stock=parseFloat($("#productStock").val());var goodsInfoAdded=parseFloat($("#goodsInfoAdded").val());if(goodsInfoAdded!=1){$(".tip_text").html("货品已下架!")}if(count<=stock){addCartNum=addCartNum+1;var goodsNum=$('input[id="produsubctcount"]').val()==""?null:$('input[id="produsubctcount"]').val();var productId=$('input[id="productId"]').val()==""?null:$('input[id="productId"]').val();$.ajax({url:$('input[id="basePath"]').val()+"/addproducttoshopcarnewAJAX.htm",type:"post",async:false,data:{goodsNum:goodsNum,productId:productId},success:function(data){if(data.sumNum!=null&&data.sumNum>0){$("#count").show();$("#count").text(data.sumNum)}}})}else{$(".buy_now_tip").click()}});var buyNum=0;$(".buy_now").click(function(){$(".tip_text").html("库存不足!");var count=parseFloat($(".product_count").val());var stock=parseFloat($("#productStock").val());if(count<=stock){buyNum=buyNum+1;var goodsNum=$('input[id="produsubctcount"]').val()==""?null:$('input[id="produsubctcount"]').val();var maxNum=$("#buynum").val();if(maxNum&&goodsNum>parseInt(maxNum)){alert("促销商品，最多只能买"+maxNum+"件");return}var productId=$('input[id="productId"]').val()==""?null:$('input[id="productId"]').val();location.href=$('input[id="basePath"]').val()+"/immediatelyBuy.htm?goodsNum="+$(".product_count").val()+"&productId="+$("#productId").val()+"&distinctId=1103"}else{$(".buy_now_tip").click()}})});function putPageComment(type,data){var commentHtml="";if(data.list!=null&&data.list.length>0){for(var l=0;l<data.list.length;l++){var comment=data.list[l];commentHtml+="<div class='comment_item'><p><strong>"+comment.commentContent+"</strong></p>"+"<p class='light spec_buys'></p><p class='light'>普通会员 "+comment.customerNickname+"</p><span>"+timeStamp2String(comment.buyTime)+"</span></div>"}var paging="";var pageNo=0;if((data.pageNo-2)>0){pageNo=(data.pageNo-2)}else{pageNo=data.firstPageNo}var endNo=0;if((data.lastPageNo-1)>0){endNo=(data.lastPageNo-2)}else{endNo=1}if(data.pageNo==1){paging+="<div class='col-xs-6'><a class='disabled' href='javascript:;'>&lt;&nbsp;上一页</a></div>"}else{paging+="<div class='col-xs-6'><a ";if(data.nextPageNo>0){paging+="onClick='loadComment("+data.prePageNo+","+type+");'"}paging+=" href='javascript:;'>&lt;&nbsp;上一页</a></div>"}if((data.pageNo==data.lastPageNo||data.endNo<=1)){paging+="<div class='col-xs-6'> <a href='javascript:;' class='disabled'>下一页&nbsp;&gt;</a> </div>"}else{paging+="<div class='col-xs-6'> <a href='javascript:;' ";if(data.nextPageNo>0){paging+=" onClick='loadComment("+data.nextPageNo+","+type+");'"}paging+=" >下一页&nbsp;&gt;</a> </div>"}$(".comment_pages").html(paging)}else{commentHtml+="<div class='comment_item'><p><strong>暂无商品评价！</strong></p></div>"}$(".comment_item_list").html(commentHtml);var spec=$(".chooseParamId");var html="";if(null!=spec&&spec.length>0){html+="";for(var i=0;i<spec.length;i++){html+=""+$(spec[i]).attr("data-spec")+"："+$(spec[i]).attr("data-detail")+"&nbsp;&nbsp;&nbsp;"}html+="";$(".spec_buys").html(html)}}function timeStamp2String(time){var date=new Date(parseFloat(time));var datetime=new Date();datetime.setTime(date);var year=datetime.getFullYear();var month=datetime.getMonth()+1<10?"0"+(datetime.getMonth()+1):datetime.getMonth()+1;var date=datetime.getDate()<10?"0"+datetime.getDate():datetime.getDate();var hour=datetime.getHours()<10?"0"+datetime.getHours():datetime.getHours();var minute=datetime.getMinutes()<10?"0"+datetime.getMinutes():datetime.getMinutes();var second=datetime.getSeconds()<10?"0"+datetime.getSeconds():datetime.getSeconds();return year+"-"+month+"-"+date+" "+hour+":"+minute+":"+second};