$(function () {
    jQuery.fn.isChildAndSelfOf = function (e) {
        return this.closest(e).length > 0
    };
    isImgLoad(function (){
        $(".app-slides").jCarouselLite({
            btnNext: ".slide-next",
            btnPrev: ".slide-prev",
            onMouse: !0,
            auto: 3e3,
            speed: 500,
            visible: 3,
            scroll: 1
        });
        var e = ($("html").width() - 2048) / 2;
        $(".app-slides").css("margin-left", e), $(window).resize(function () {
            var e = ($("html").width() - 2048) / 2;
            $(".app-slides").css("margin-left", e)
        })
    });
    $(window).resize(function () {
        var e = ($("html").width() - 2048) / 2;
        //$(".app-slides").css("margin-left", e)
    }),
     $(".app-tabs a").click(function(){
        var e = $(this);
        _time = setTimeout(function () {
            var n = e.parent("li").index(), s = 90 * n;
            $(".underline").animate({left: s}, 200), e.addClass("on").parent("li").siblings().find(".on").removeClass("on"), $(".app-lists").find(".on").removeClass("on"), $(".app-list:eq(" + n + ")").addClass("on")
        }, 200)
    }), $(".select-menu strong").click(function () {
        $(this).next(".pop-menu").show()
    }), $(document).click(function (e) {
        $(e.target).isChildAndSelfOf(".select-menu") || $(".pop-menu").slideUp("fast")
    }), $(".pop-menu a").click(function () {
        var e = $(this).text();
        $(this).addClass("selected").siblings(".selected").removeClass("selected"), $(this).parent(".pop-menu").slideUp("fast").prev("strong").find("span").text(e)
    }), $(".app-list").on("click", ".menu-down", function () {
        var e = $(this), n = e.parent().next(".extra-menu");
        $(".extra-menu:visible").slideUp("fast"), "block" == n.css("display") ? n.slideUp("fast") : n.show()
    }), $(document).click(function () {
        $(event.target).isChildAndSelfOf(".menu-down") || $(".extra-menu").slideUp("fast")
    }),  $(".app-img, .app-infomation").click(function () {
        $(".dia-mask, .app-dialog").fadeIn("fast")
    }), $(".dia-close").click(function () {
        $(".dia-mask, .app-dialog").fadeOut("fast")
    })
});


var count = 4;
var t_img; // 定时器
var isLoad = true; // 控制变量
/**
 * 判断图片加载的函数
 * @param callback
 */
function isImgLoad(callback){
    // 注意我的图片类名都是cover，因为我只需要处理cover。其它图片可以不管。
    // 查找所有封面图，迭代处理
    $('.slide_img').each(function(){
        // 找到为0就将isLoad设为false，并退出each
        if(this.width <10){
            count --;
            if(count <0) {
                isLoad = true;
                return true;
            }
            isLoad = false;
            return false;
        }
    });
    // 为true，没有发现为0的。加载完毕
    if(isLoad){
        clearTimeout(t_img); // 清除定时器
        // 回调函数
        callback();
        // 为false，因为找到了没有加载完成的图，将调用定时器递归
    }else{
        isLoad = true;
        t_img = setTimeout(function(){
            isImgLoad(callback); // 递归扫描
        },1); // 我这里设置的是1毫秒就扫描一次，可以自己调整
    }
}