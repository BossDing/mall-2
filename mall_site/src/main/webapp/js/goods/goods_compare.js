$(function(){refreshCompare();$(".compare").click(function(){var goodsId=$(this).attr("product_id");if($(this).hasClass("checked")){$(".goods_contrast").show();unCompare(goodsId)}else{$(".goods_contrast").show();compare(goodsId)}});$(".delete").click(function(){unCompare($(this).attr("product_id"))})});function compareGoodsList(obj){var goodsId=$(obj).attr("product_id");if($(obj).hasClass("checked")){$(".goods_contrast").show();unCompare(goodsId)}else{$(".goods_contrast").show();compare(goodsId)}}var compare_cookie_name="_npstore_compare_goodsId";function compare(goodsId){var goodsIds=getCookie(compare_cookie_name);if(goodsIds!=null){var ids=goodsIds.split(".");for(var i=0;i<ids.length;i++){if(ids[i]==goodsId){loadCompareGoods();$(".compare_box").show();return}}}if(goodsIds!=null&&goodsIds!=""&&goodsIds.toString().split(".").length==4){$(".info_tip_content2").html("对比栏已满！");$(".info_tip_img2").attr("src","../images/error.png");$(".info_tip_cancel2").attr("href","javascript:;").hide();$(".info_tip_submit2").attr("href","javascript:;").show().html("确定").unbind("click");$(".info_tip_submit2").click(function(){cls()});dia(2);$("#compare"+goodsId).removeClass("checked");loadCompareGoods();$(".compare_box").show();return}if(goodsIds==null||goodsIds==""){setCookie(compare_cookie_name,goodsId)}else{setCookie(compare_cookie_name,goodsIds.toString()+"."+goodsId)}refreshCompare();$(".compare_box").show()}function unCompare(goodsId){var goodsIds=getCookie(compare_cookie_name).toString().split(".");var newGoodsIds="";delCookie(compare_cookie_name);for(var i=0,j=0;i<goodsIds.length;i++){if(goodsIds[i]==goodsId){continue}if(j==0){newGoodsIds+=goodsIds[i]}else{newGoodsIds+="."+goodsIds[i]}j++}setCookie(compare_cookie_name,newGoodsIds);refreshCompare();$(".compare_box").show()}function hideCompareBox(){$(".goods_contrast").hide()}function refreshCompare(){var cookieValue=getCookie(compare_cookie_name);if(cookieValue!=null){$(".compare").removeClass("checked");var goodsIds=cookieValue.toString().split(".");for(var i=0;i<goodsIds.length;i++){$("#compare"+goodsIds[i]).addClass("checked")}}loadCompareGoods()}function loadCompareGoods(){var cookieValue=getCookie(compare_cookie_name);var goodsIds="0";if(cookieValue!=null&&cookieValue!=""){goodsIds=cookieValue.toString().split(".")}else{$(".compare_box").hide()}var param="";for(var i=0;i<4;i++){param+=getGoodsIdParam(goodsIds,i)}$.ajax({url:"../goods/getCompareGoods.html?goodsIds="+param,success:function(data){$("#compareBox").html("");var html="";var productName="";for(var i=0;i<data.length;i++){if(data[i].productVo.productName.length>18){productName=data[i].productVo.productName.substring(0,18)}else{productName=data[i].productVo.productName}html+='<dl class="has_item clearfix fl">';if(data[i].productVo.imageList.length>0){html+='<dt><a href="../item/'+data[i].productVo.goodsInfoId+'.html" target="_blank"><img width="50" alt="'+data[i].productVo.productName+'" src="'+data[i].productVo.imageList[0].imageThumName+'" /></a></dt>'}else{html+="<dt>"+(i+1)+"</dt>"}html+='<dd><p class="ct-item-name"><a href="../item/'+data[i].productVo.goodsInfoId+'.html" target="_blank">'+productName+"</a></p>"+'<span class="ct-item-price">￥'+accAddInt(data[i].productVo.goodsInfoPreferPrice,0)+"</span>"+'<a href="javascript:void(0);" class="del-ct-item"  onclick="unCompare('+data[i].productVo.goodsInfoId+')">删除</a></dd></dl>'}for(var i=data.length+1;i<=4;i++){html+='<dl class="empty_item clearfix fl"><dt>'+i+"</dt>"+"<dd>你还可以继续添加</dd></dl>"}html+='<div class="ct_operation fl tc">';if(goodsIds.length<2){html+='<a class="contrast_btn dis_ct" href="javascript:;" class="compare_btn">对比</a>'}else{html+='<a class="contrast_btn" href="javascript:;" onclick="compareGoods();" class="compare_btn">对比</a>'}html+='<p class="del-items mt10"><a href="javascript:;" onclick="deleteAll();">清空对比栏</a></p>';$("#compareBox").html(html);if(data.length<=0){$(".goods_contrast").hide()}else{$(".goods_contrast").show()}}})}function getGoodsIdParam(goodsIds,position){var param="";if(position==0){if(goodsIds[0]!=null&&goodsIds[0]!="undefined"){param+=goodsIds[0]}else{param+="0"}}else{if(goodsIds[position]!=null&&goodsIds[position]!="undefined"){param+="-"+goodsIds[position]}else{param+="-0"}}return param}function compareGoods(){var goodsIds=getCookie(compare_cookie_name).toString().split(".");if(goodsIds.length<2){$(".info_tip_content2").html("至少选择2个商品进行对比！");$(".info_tip_img2").attr("src","../images/error.png");$(".info_tip_cancel2").attr("href","javascript:;").hide();$(".info_tip_submit2").attr("href","javascript:;").show().html("确定").unbind("click");$(".info_tip_submit2").click(function(){cls()});dia(2);return}var param="";for(var i=0;i<4;i++){param+=getGoodsIdParam(goodsIds,i)}window.open("../compare/"+param+".html")}function deleteAll(){$(".compare").removeClass("checked");delCookie(compare_cookie_name);loadCompareGoods();$(".compare_box").show();$(".goods_contrast").hide()}function setCookie(name,value){var exp=new Date();exp.setTime(exp.getTime()+7*24*60*60*1000);
    document.cookie=name+"="+escape(value)+";expires="+exp.toGMTString()+";path=/"}function getCookie(name){var arr=document.cookie.match(new RegExp("(^| )"+name+"=([^;]*)(;|$)"));if(arr!=null){return unescape(arr[2])}return null}function delCookie(name){var exp=new Date();exp.setTime(exp.getTime()-1);var cval=getCookie(name);if(cval!=null){document.cookie=name+"="+cval+";expires="+exp.toGMTString()+";path=/"}}function getRootPath(){var curWwwPath=window.document.location.href;var pathName=window.document.location.pathname;var pos=curWwwPath.indexOf(pathName);var localhostPaht=curWwwPath.substring(0,pos);var projectName=pathName.substring(0,pathName.substr(1).indexOf("/")+1);return(localhostPaht+projectName)};