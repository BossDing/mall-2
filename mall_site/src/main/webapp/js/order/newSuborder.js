$(function(){loadAllAddress();defaultAddress($(".ch_address").val());$('input[name="isbaoyou"]').each(function(){if($(this).val()=="0"){var tid=$(this).attr("data-id");$(".freight-cont"+tid).hide()}});$(".qmark-tip").mouseover(function(){var a=$(this).parents("li").width();a=a-parseInt($(this).css("right"));var x=a;var y=$(this).css("top");x=parseInt(x)-35;y=parseInt(y)+21;var dd=$(this).attr("data-tips");$(".online_tips").css("left",x);$(".online_tips").css("top",y)});$(".fretype").click(function(){if(!$(this).hasClass("disabled")){$(".fretype").removeClass("curr ");$(this).addClass("curr ");if($(this).attr("id")=="ziti"){$("#selfpick_shipment").show()}var _this=$(this);$(".bossitem").each(function(index,item){if($(this).attr("data-id")==2){if(_this.attr("id")=="ziti"){$(this).addClass("disabled")}else{$(this).removeClass("disabled")}}else{if(_this.attr("id")!="ziti"){$(this).removeClass("disabled");$("#ep").html("￥"+$("#yfprice").val());$("#lastpay").html("￥"+$("#sumpriceflag").val());$("#lastpays").html("￥"+$("#sumpriceflag").val())}else{var bossyfprice=$("#bossyfprice").val();var thirdprice=Subtr($("#yfprice").val(),$("#bossyfprice").val());$("#ep").html("￥"+thirdprice);$("#lastpay").html("￥"+Subtr($("#sumpriceflag").val(),bossyfprice));$("#lastpays").html("￥"+Subtr($("#sumpriceflag").val(),bossyfprice))}}});if($(this).attr("id")=="ziti"){$("#selfpick_siteDiv .site-item").each(function(index,item){if($(this).hasClass("site-item-selected")){var idflag=$(this).attr("pickId");if(idflag!=null){$("#deliveryPointId").val(idflag)}}});$("#selfpick_shipment").show();$("#typeId").val(1)}else{$("#selfpick_shipment").hide();$("#typeId").val(0)}}});$(".bossitem").mouseover(function(){$(this).addClass("payment-item-hover")});$(".thirditem").mouseover(function(){$(this).addClass("payment-item-hover")});$(".thirditem").mouseout(function(){$(this).removeClass("payment-item-hover")});$(".bossitem").mouseout(function(){$(this).removeClass("payment-item-hover")});$(".bossitem").click(function(){if(!$(this).hasClass("disabled")){$(".bossitem").removeClass("item-selected");$(this).addClass("item-selected");var paytype=$(this).attr("data-id");$(".ch_pay").val(paytype);$(".fretype").each(function(index,item){if($(this).attr("id")=="ziti"){if(paytype==2){$(this).addClass("disabled")}else{var deliveryPointId=$("#deliveryPointId").val();if(deliveryPointId!=0&&deliveryPointId!=null&&deliveryPointId!=""){$(this).removeClass("disabled")}}}else{if(paytype!=2){$(this).removeClass("disabled")}}})}});$(".thirditem").click(function(){$(".thirditem").removeClass("item-selected");$(this).addClass("item-selected");$(".ch_paythird").val($(this).attr("data-id"))});$(".bossitem").each(function(){if($(this).hasClass("item-selected")){$(".ch_pay").val($(this).attr("data-id"))}});$(".thirditem").each(function(){if($(this).hasClass("item-selected")){$(".ch_paythird").val($(this).attr("data-id"))}});$(".save_address").click(function(){var addressName=$(".save_add_name");var infoProvince=$("#infoProvince");var infoCity=$("#infoCity");var infoCounty=$("#infoCounty");var infoStreet=$("#infoStreet");var addressDetail=$(".save_add_detail");var addressMoblie=$(".save_add_mobile");var addressPhone=$(".save_add_phone");var addressZip=$(".save_add_post");var params="";var bool=true;if($(addressName).val()!=null&&$.trim($(addressName).val())!=""){var regexp=new RegExp("[`~!@#$^&*()={}':;',\\[\\]<>/?~！@#￥……&*（）{}【】‘；：”“'。，、？]");if(regexp.test($(addressName).val())){$(".addressNameTip").text("存在特殊字符").addClass("tipserror");$(".addressNameTip").text("存在特殊字符").removeClass("error-msg");return false}$("addressNameTip").text("").removeClass("tipserror");params+="addressName="+$(addressName).val()}else{$(".addressNameTip").text("收货人名称不能为空!").addClass("tipserror");$(".addressNameTip").text("收货人名称不能为空!").removeClass("error-msg");bool=false;return}if($(infoProvince).val()!=""&&$(infoProvince).val()!=null){params+="&infoProvince="+$(infoProvince).val()}if($(infoCity).val()!=""&&$(infoCity).val()!=null){params+="&infoCity="+$(infoCity).val()}if($(infoCounty).val()!=""&&$(infoCounty).val()!=null){params+="&infoCounty="+$(infoCounty).val()}if($(infoStreet).val()!=""&&$(infoStreet).val()!=null){params+="&infoStreet="+$(infoStreet).val()}if($(addressDetail).val()!=null&&$.trim($(addressDetail).val())!=""){var regexp=new RegExp("[`~!@#$^&*()={}':;',\\[\\]<>/?~！@#￥……&*（）{}【】‘；：”“'。，、？]");if(regexp.test(addressDetail.val())){$(".addressDetailTip").text("包含特殊字符!").addClass("tipserror");$(".addressDetailTip").text("包含特殊字符!").removeClass("error-msg");return false}$(".addressDetailTip").text("").removeClass("tipserror");$(".addressDetailTip").text("").addClass("error-msg");params+="&addressDetail="+$(addressDetail).val()}else{$(".addressDetailTip").text("详细地址不能为空!").addClass("tipserror");$(".addressDetailTip").text("详细地址不能为空!").removeClass("error-msg");bool=false;return}if($(addressMoblie).val()!=""&&$(addressMoblie).val()!=null){if(/^0?(13|15|18|14|17)[0-9]{9}$/.test($(addressMoblie).val())){$(".addressPhoneTip").text("").removeClass("tipserror");
    $(".addressPhoneTip").text("").addClass("error-msg");params+="&addressMoblie="+$(addressMoblie).val()}else{$(".addressPhoneTip").text("手机号码格式不对!").addClass("tipserror");$(".addressPhoneTip").text("手机号码格式不对!").removeClass("error-msg");return}}else{$(".addressPhoneTip").text("手机号码不能为空!").addClass("tipserror");$(".addressPhoneTip").text("手机号码不能为空!").removeClass("error-msg");bool=false;return}if($("#cust_address_default").val()!=""){params+="&isDefault="+$("#cust_address_default").val()}var conditions="mobel="+addressMoblie.val();$.ajax({type:"POST",url:"../isshowmobelexist.htm",data:conditions,async:false,success:function(msg){if(msg=="1"){bool=false;$(".addressPhoneTip").html("手机号码已存在,请更换号码，或者<a href='../login.html'>登陆 </a>").addClass("tipserror");$(".addressPhoneTip").html("手机号码已存在,请更换号码，或者<a href='../login.html'>登陆 </a>").removeClass("error-msg")}}});if($(addressPhone).val()!=""&&$(addressPhone).val()!=null){if(/^((0[0-9]{2,3}\-)|(\(0[0-9]{2,3}\)))?([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$/.test($(addressPhone).val())){if($(addressPhone).val()!=""&&$(addressPhone).val()!=null){$(".addressPhoneTip").text("").removeClass("tipserror");$(".addressPhoneTip").text("").addClass("error-msg");params+="&addressPhone="+$(addressPhone).val()}}else{$(".addressPhoneTip").text("电话格式不正确!").addClass("tipserror");$(".addressPhoneTip").text("电话格式不正确!").removeClass("error-msg");bool=false}}if($(".save_add_post").val()!=""&&$(".save_add_post").val()!=null){if(/^[1-9]\d{5}(?!\d)$/.test($(".save_add_post").val())){$(".addPostTips").text("").removeClass("tipserror");$(".addPostTips").text("").addClass("error-msg");params+="&addressZip="+$(addressZip).val()}else{$(".addPostTips").text("邮政编码格式不正确").addClass("tipserror");$(".addPostTips").text("邮政编码格式不正确").removeClass("error-msg");bool=false}}if(bool){if($(".save_update_add_id").val()>0){params+="&addressId="+$(".save_update_add_id").val();if($(".save_add_post").val()==""){params+="&addressZip=''"}$.ajax({type:"post",url:"../goods/modiCustAddress.html?CSRFToken="+$("#csrfNo").val(),data:encodeURI(params),async:false,success:function(data){if(data){loadAllAddress();cls();$("#con_flag").html("更新地址成功!");$("#addressflag").val(1);dia(10)}else{$("#con_00").html("更新地址失败!");dia(6)}}})}else{if($(".all_cust_address").length>=9){$("#con_00").html("收货地址最多只能保存9个!");dia(6);return false}$.ajax({type:"post",url:"../goods/ajaxAddCustomerAddressFromOrder.html?CSRFToken="+$("#csrfNo").val(),data:encodeURI(params),async:false,success:function(data){if(data){loadAllAddress();cls();$("#con_00").html("添加地址成功!");dia(6);if($("#cust_address_default").val()=="1"){getExpressprice()}}else{$("#con_00").html("新增地址失败!");dia(6)}}})}}});$(".save-tit").click(function(){if($(".invoice_title").val()==""){$(".invoice_title").attr("placeholder","不能为空");return}else{var reg=/^([\u4e00-\u9fa5_A-Za-z0-9 \\`\\~\\!\\@\\#\\$\\^\\&\*\(\)\=\{\}\'\:\;\'\,[\]\.\/\?\~\！\@\#\￥\…\…\&\*\（\）\;\—\|\{\}\【\】\‘\；\：\”\“\'\。\，\、\？])+$/;if(!reg.test($(".invoice_title").val())){$(".invoice_title").val("");$(".invoice_title").attr("placeholder","不能输入特殊字符！");return}}$(this).addClass("hide");$(this).parent().parent().prepend("<b></b>");$(this).parents(".add-invoice-tit").find("input[name='invoiceTitle']").attr("readonly","readonly");$(".invoice-list").on("mouseover",".new_add",function(){$(".update-tit").removeClass("hide");$(".delete-tit").removeClass("hide")});$(".invoice-list").on("mouseout",".new_add",function(){$(".update-tit").addClass("hide");$(".delete-tit").addClass("hide")})});$(".update-tit").click(function(){$(this).addClass("hide");$(this).next().removeClass("hide");$(this).parents(".add-invoice-tit").find("input[name='invoiceTitle']").removeAttr("readonly","readonly");$(".invoice-list").on("mouseover",".new_add",function(){$(".update-tit").addClass("hide");$(".delete-tit").removeClass("hide")});$(".invoice-list").on("mouseout",".new_add",function(){$(".update-tit").addClass("hide");$(".delete-tit").addClass("hide")})});$(".save_invoice").click(function(){if($(".invoiceType ").hasClass("tab-item-selected")){$(".ch_invoiceType").html($(".invoiceType").html());$(".ch_invoceTypeValue").val($(".invoiceType").val());$(".tr_invoiceTitleView").hide();$(".invoiceContentMing").hide();cls();return}else{$(".ch_invoiceType").html($(".invoiceType").next().html());$(".ch_invoceTypeValue").val($(".invoiceType").next().val())}if($(".new_add").hasClass("invoice-item-selected")){var reg=/^([\u4e00-\u9fa5_A-Za-z0-9 \\`\\~\\!\\@\\#\\$\\^\\&\*\(\)\=\{\}\'\:\;\'\,[\]\.\/\?\~\！\@\#\￥\…\…\&\*\（\）\;\—\|\{\}\【\】\‘\；\：\”\“\'\。\，\、\？])+$/;if(!reg.test($(".invoice_title").val())){$(".invoice_title").val("");$(".invoice_title").attr("placeholder","不能输入特殊字符！");return}$(".tr_invoiceTitleView").html($(".invoice_title").val());$(".ch_invoceTitleValue").val($(".invoice_title").val())}else{$(".tr_invoiceTitleView").html("个人");$(".ch_invoceTitleValue").val("个人")}$(".tr_invoiceTitleView").show();var invoiceContent=$("li[name=invoiceContent]");for(var i=0;i<invoiceContent.length;i++){if($(invoiceContent[i]).hasClass("invoice-item-selected")){$(".invoiceContentMing").show();
    $(".invoiceContentMing").html($(invoiceContent[i]).html());$(".ch_invoiceContentValue").val($(invoiceContent[i]).html())}}cls()});var bossSumPrice=$("#bosssumPrice").val();var pointSet=$("#pointSet").val();if(bossSumPrice>0){var keyishiyong=accDiv(accMul(bossSumPrice,10),pointSet);keyishiyong=parseInt(parseInt(accDiv(parseInt(keyishiyong),10))+"0");var jifen=$("#jifen1").val();if(jifen<keyishiyong){$("#muqianjifen1").html(jifen);$("#jifen2").val(jifen)}else{$("#muqianjifen1").html(keyishiyong);$("#jifen2").val(keyishiyong)}}else{$("#muqianjifen1").html(0);$("#jifen2").val(0)}});function closeAddresswindow(obj){cls();$(".consignee-item").each(function(index,item){if($(this).hasClass("item-selected")){$(this).click()}})}function getExpressprice(){var yfprice=0;var bossyfprice=0;var payprice=0;var addsId=$(".ch_address").val();var boxs=new Array();$('input[name="box"]').each(function(){boxs.push(parseInt($(this).val()))});$.ajax({type:"post",url:"../getnewexpressprice.htm",async:false,data:{addressId:addsId,shopIds:boxs},dataType:"json",success:function(data){var totalprice=0;var subprice=0;var vip=$("#vip").val();$.each(data,function(key,value){if(data!=null&&data!=""){if(key=="sumOldPrice"){$("#sumOldPrice").html("￥"+accAdd(value,0));totalprice=value}if(key=="sumPrice"){$("#lastpays").html("￥"+accAdd(value,0));payprice=value;subprice=value;$("#payPrice").val(value)}if(key=="bossSumPrice"){$("#bosssumPrice").val(value)}if(key=="discountPrice"){$("#discount").val(value);$("#discount").html("-￥"+accAdd(value,0))}if(key=="freightmoney"){yfprice=accAdd(value,yfprice)}if(key=="bossfreight"){bossyfprice=accAdd(value,bossyfprice)}if(key=="detailBean"){if(value!=null){$.each(value,function(i,gooddata){if(value!=null){if(vip==1){$(".price_"+gooddata.productVo.goodsInfoId).html("￥"+(gooddata.productVo.goodsInfoVipPrice).toFixed(2))}else{$(".price_"+gooddata.productVo.goodsInfoId).html("￥"+(gooddata.productVo.goodsInfoPreferPrice).toFixed(2))}if(gooddata.productVo.goodsInfoStock<=0){$(".stock_"+gooddata.productVo.goodsInfoId).html("无货")}else{$(".stock_"+gooddata.productVo.goodsInfoId).html("现货")}}})}}}});$("#yhprice").html("-￥"+accAdd(Subtr(totalprice,subprice),0))}});$("#ep").html("￥"+yfprice);$("#yfprice").val(yfprice);$("#bossyfprice").val(bossyfprice);$("#lastpay").html("￥"+accAdd(Subtr(accAdd(yfprice,payprice),$("#discount").val()),0));$("#lastpays").html("￥"+accAdd(Subtr(accAdd(yfprice,payprice),$("#discount").val()),0));$("#sumPrice").val(accAdd(yfprice,payprice));$("#sumpriceflag").val(accAdd(yfprice,payprice))}function quxiao(){cls()}function loadAllAddress(){setDefaultForm();$(".save_update_add_id").val("");var addsId="";$.ajax({type:"post",url:"../goods/queryCustAddressForSubOrder.html",async:false,success:function(data){var address_html="";if(data==""){return}$(".cust_allAddress").html("");for(var i=0;i<data.addresses.length;i++){updateadd(data.addresses.length);var address=data.addresses[i];address_html+="<li>"+"<div class='consignee-item cust_address_"+address.addressId;var addHtml=address.province.provinceName+" "+address.city.cityName+" "+address.district.districtName+" ";if(null!=address.street&&address.street.streetName!=""){addHtml=addHtml+address.street.streetName}addHtml=addHtml+" "+address.addressDetail;if(address.isDefault=="1"){addsId=address.addressId;address_html+=" item-selected";$(".consignee-foot").html("<p>寄送至："+addHtml+"<br>收货人："+address.addressName+" "+address.addressMoblie.substring(0,3)+"****"+address.addressMoblie.substring(8,11)+"</p>");$(".ch_address").val(address.addressId);$(".ch_distinctId").val(address.district.districtId)}var addHtml=address.province.provinceName+" "+address.city.cityName+" "+address.district.districtName+" ";if(null!=address.street&&address.street.streetName!=""){addHtml=addHtml+address.street.streetName}addHtml=addHtml+" "+address.addressDetail;if(addHtml.length>=40){addHtml=addHtml.substring(0,38);addHtml+="..."}address_html+="'name='address_in' value='"+address.addressId+"' add-name='"+address.addressName+"'"+" add-city='"+address.province.provinceName+address.city.cityName+address.district.districtName+"'";if(null!=address.street&&address.street.streetName!=""){address_html+=address.street.streetName}address_html+=" add-detail='"+address.addressDetail+"'"+" add-mobi='"+address.addressMoblie+"'"+" add-phone='"+address.addressPhone+"'"+" add-province='"+address.province.provinceId+"'"+" add-cityid='"+address.city.cityId+"'"+" add-district='"+address.district.districtId+"'"+" add_post='"+address.addressZip+"'";if(null!=address.street&&address.street.streetId!=""){address_html+=" add-street='"+address.street.streetId+"'"}else{address_html+=" add-street='-1'"}var strName="";if(address.addressName.length>5){strName=address.addressName.substring(0,2)+"..."+address.addressName.substring(address.addressName.length-1,address.addressName.length)}else{strName=address.addressName}address_html+=" add-email='"+address.addressEmail+"'"+"><span limit='3' title='"+address.addressName+" "+address.province.provinceName+"'>"+strName+" "+address.province.provinceName+"</span><b></b></div> "+"<div class='addr-detail'><span class='addr-name ml10' limit='6' title='"+address.addressName+"'>"+address.addressName+"</span>"+"<span class='addr-info ml10' limit='32' title='"+addHtml+" '>"+addHtml+"</span>"+"<span class='addr-tel ml10'>"+address.addressMoblie.substring(0,3)+"****"+address.addressMoblie.substring(8,11)+"</span></div>"+"<div class='op-btns' consigneeid='137873025'>"+"<a class='setdefault-consignee' href='javascript:void(0);' id='addressflag' onclick='defaultAddress("+address.addressId+");'>设为默认地址</a>"+"<a class='edit-consignee' href='javascript:void(0);' onclick='modiAddress("+address.addressId+");'>编辑</a>"+"<a class='del-consignee ' href='javascript:void(0);' onclick='checkdel("+address.addressId+");'>删除</a></div></li>"
}$(".cust_allAddress").html(address_html);var flagchoose=0;if($(".cust_allAddress").find(".consignee-item").length>0){$(".cust_allAddress").find(".consignee-item").each(function(index,item){if($(this).hasClass("item-selected")){flagchoose=1}})}if($(".cust_allAddress").find(".consignee-item").length==0||flagchoose==0){$("#ziti").addClass("disabled");$("#ziti").removeClass("curr");$("#selfpick_shipment").hide();if(!$(".bossfretype").hasClass("curr")){$(".bossfretype").addClass("curr")}$(".bossitem").each(function(index,item){if($(this).hasClass("disabled")){$(this).removeClass("disabled")}})}$(".consignee-item").click(function(){$(".consignee-item").removeClass("item-selected");$(this).addClass("item-selected");defaultAddress($(this).attr("value"))});var li_n=$(".consignee-cont li").length-5;var li_step=0;if(li_n>0){$(".consignee-cont ul").height($(".consignee-cont li").length*40);$(".addr-down").removeClass("disabled");$(".addr-down").click(function(){$(".addr-up").removeClass("disabled");if(li_step<li_n){li_step++;$(".consignee-cont ul").animate({top:-40*li_step},300);if(li_step==li_n){$(".addr-down").addClass("disabled")}}});$(".addr-up").click(function(){$(".addr-down").removeClass("disabled");if(li_step>0){li_step--;$(".consignee-cont ul").animate({top:-40*li_step},300);if(li_step==0){$(".addr-up").addClass("disabled")}}})}}})}function checkdel(obj){$("#deladdress").val(obj);dia(7)}function defaultAddress(id){if(id==null||id==""){$("#ziti").addClass("disabled");return}$(".ch_address").val(id);$.ajax({type:"POST",url:"../goods/modifyDefaultAddressForOrder.html",async:false,data:{"addressId":id},success:function(data){if(data){loadAllAddress();checkProductByAddress();getExpressprice()}else{$("#con_00").html("设置失败,请重试!");dia(6)}}});initziti()}function initziti(){var id=$(".ch_address").val();if(id==null||id==""){$("#ziti").addClass("disabled");return}$.get("../ajaxgetSince.htm",function(data){$("#ziti").show();if(data!=null&&data!=""){$(".fretype").each(function(index,item){if($(this).attr("id")=="ziti"){$(this).removeClass("disabled");$("#selfpick_name").text(data[0].name)}});var since="";since+='<div class="pick-sites pick-sites-more" id="pick-sites">';$.each(data,function(index,dps){var classflag="";var linkflag="";if(index==0){classflag="site-item-selected";$("#deliveryPointId").val(dps.deliveryPointId)}if(dps.linkman!=null&&dps.linkman!=""){linkflag="&nbsp;&nbsp; 联系人:"+dps.linkman+"&nbsp; 联系电话:"+dps.telephone}since+='<div  pickid="'+dps.deliveryPointId+'" onclick="doSelectPicksite(this)" pickname="'+dps.name+'" '+'class="site-item '+classflag+'" >'+' <div class="site-in-short" style="cursor:pointer"  > '+dps.name+" <b></b> </div>"+'<div class="field">'+'<span class="tip">'+"地址："+dps.temp2+dps.temp3+dps.address+linkflag+'</span>  </div> <div class="clr"></div> </div> '});since+="</div>";$(".since").html(since);if(data.length<3){$("#pick-sites").removeClass("overflow")}else{$("#pick-sites").addClass("overflow")}$(".bossitem").each(function(index,item){if($(this).hasClass("item-selected")&&$(this).attr("data-id")==2){$("#ziti").addClass("disabled")}})}else{$("#ziti").hide();$("#selfpick_shipment").hide();$("#deliveryPointId").val(0);$(".fretype").each(function(index,item){if($("#deliveryPointId").val()==0){if($(this).attr("id")=="ziti"){$(this).addClass("disabled");$(this).removeClass("curr");$(this).prev().addClass("curr");$(".bossitem").each(function(index,item){$(this).removeClass("disabled")})}}})}})}function checkProductByAddress(){var distinctId=$(".ch_distinctId").val();var _list=new Array;$('input[name="box"]').each(function(){_list.push(parseInt($(this).val()))});$.ajax({url:"../checkWareByCity.htm?shoppingCartId="+_list+"&distinctId="+distinctId,type:"post",success:function(data){if(data!=null){for(var i=0;i<data.warestockList.length;i++){if(data.warestockList[i]>0){$("#product"+data.productIdList[i]).html("现货").removeClass("red")}else{$("#product"+data.productIdList[i]).html("无货").addClass("red")}}}else{$("#con_00").html("网络延迟,请重试!");dia(6)}}})}function modiAddress(id){$(".save_update_add_id").val(id);var address=$(".cust_address_"+id);$(".save_add_name").val($(address).attr("add-name"));$(".save_add_detail").val($(address).attr("add-detail"));$(".save_add_mobile").val($(address).attr("add-mobi"));$(".save_add_phone").val($(address).attr("add-phone"));$(".save_add_post").val($(address).attr("add_post"));if($(".save_add_post").val()=="null"){$(".save_add_post").val("")}if($(".save_add_phone").val()=="null"){$(".save_add_phone").val("")}$(".save_add_email").val($(address).attr("add-email"));if($(".save_add_email").val()=="null"){$(".save_add_email").val("")}selectLocationOption($(address).attr("add-province"),$(address).attr("add-cityid"),$(address).attr("add-district"),$(address).attr("add-street"),"infoProvince","infoCity","infoCounty","infoStreet");dia(1)}function delAddress(){var id=$("#deladdress").val();$.get("../goods/delCustAddressById.html?addressId="+id,function(data){if(data){loadAllAddress()
}else{$("#con_00").html("删除失败,请重试!");dia(6)}})}function checkAddressName(){var addressName=$(".save_add_name");if($(addressName).val()!=""){$(".addressNameTip").text("").removeClass("tipserror");$(".addressNameTip").text("").addClass("error-msg")}else{$(".addressNameTip").text("收货人名称不能为空!").addClass("tipserror");$(".addressNameTip").text("收货人名称不能为空!").removeClass("error-msg")}}function checkAddressDetail(){var addressDetail=$(".save_add_detail");if($(addressDetail).val()!=""){var regexp=new RegExp("[`~!@#$^&*()={}':;',\\[\\]<>/?~！@#￥……&*（）{}【】‘；：”“'。，、？]");if(regexp.test(addressDetail.val())){$(".addressDetailTip").text("包含特殊字符!").addClass("tipserror");$(".addressDetailTip").text("包含特殊字符!").removeClass("error-msg");return false}$(".addressDetailTip").text("").removeClass("tipserror");$(".addressDetailTip").text("").addClass("error-msg")}else{$(".addressDetailTip").text("详细地址不能为空!").addClass("tipserror");$(".addressDetailTip").text("详细地址不能为空!").removeClass("error-msg")}}function checkAddressMobile(){var addressMoblie=$(".save_add_mobile");if($(addressMoblie).val()!=""){if(/^0?(13|15|18|14|17)[0-9]{9}$/.test($(addressMoblie).val())){$(".addressPhoneTip").text("").removeClass("tipserror");$(".addressPhoneTip").text("").addClass("error-msg")}else{$(".addressPhoneTip").text("手机号码格式不对!").addClass("tipserror");$(".addressPhoneTip").text("手机号码格式不对!").removeClass("error-msg");return}}else{$(".addressPhoneTip").text("手机号码不能为空!").addClass("tipserror");$(".addressPhoneTip").text("手机号码不能为空!").removeClass("error-msg");return}var conditions="mobel="+addressMoblie.val();$.ajax({type:"POST",url:"../isshowmobelexist.htm",data:conditions,success:function(msg){if(msg=="1"){$(".addressPhoneTip").html("手机号码已存在,请更换号码，或者<a href='../login.html'>登陆 </a>").addClass("tipserror");$(".addressPhoneTip").html("手机号码已存在,请更换号码，或者<a href='../login.html'>登陆 </a>").removeClass("error-msg")}}})}function checkAddressPhone(){var addressPhone=$(".save_add_phone");if($(addressPhone).val()!=""){if(/(\d{4}-?\d{7,8})|(\d{3}-?\d{8})/.test($(addressPhone).val())){if($(addressPhone).val()!=""){$(".addressPhoneTip").text("").removeClass("tipserror");$(".addressPhoneTip").text("").addClass("error-msg")}}else{$(".addressPhoneTip").text("电话格式不正确!").addClass("tipserror");$(".addressPhoneTip").text("电话格式不正确!").removeClass("error-msg")}}else{$(".addressPhoneTip").text("电话号码不能为空!").addClass("tipserror");$(".addressPhoneTip").text("电话号码不能为空!").removeClass("error-msg")}}function checkAddressEmail(){if($(".save_add_email").val()!=""&&$(".save_add_email").val()!=null){if(/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/.test($(".addEmailTips").val())){$(".addEmailTips").text("").removeClass("tipserror");$(".addEmailTips").text("").addClass("error-msg");params+="&addressEmail="+$(addressZip).val()}else{$(".addEmailTips").text("邮箱格式不正确!").addClass("tipserror");$(".addEmailTips").text("邮箱格式不正确!").removeClass("error-msg")}}}function checkAddressPost(){if($(".save_add_post").val()!=""&&$(".save_add_post").val()!=null){if(/^\d{6}$/.test($(".save_add_post").val())){$(".addPostTips").text("").removeClass("tipserror");params+="&addressZip="+$(addressZip).val()}else{$(".addPostTips").text("邮政编码格式不正确!").addClass("tipserror")}}}function setDefaultForm(){$(".save_add_name").val("");$(".save_add_detail").val("");$(".save_add_mobile").val("");$(".save_add_phone").val("");$(".save_add_post").val("");$(".save_add_email").val("");$(".addressNameTip").text("");$(".addressDetailTip").text("");$(".addressPhoneTip").text("");$(".addressEmailTip").text("")}function checkGeRen(obj){$(".invoiceTitleTip").text("");if($(obj).prop("checked")){$(".invoiceTitle").val($(".addressName").html()).addClass("none");$(".ch_invoiceTitle").val($(".addressName").html())}}function checkDanWei(obj){if($(obj).prop("checked")){$(".invoiceTitle").val("").removeClass("none")}}function changeScre(){var amount=$("#amount").val(0);jifen();$("#amount").val("")}function clearCoupon(){$("#useCoupon").val("");checkCoupon();$("#errorTips").html("")}function checkCoupon(){var boxs=new Array();$('input[name="box"]').each(function(){boxs.push(parseInt($(this).val()))});$("#codeNo").val($("#useCoupon").val());$.ajax({type:"post",url:"/getUsedCouponBycodeNo.htm?codeNo="+$("#useCoupon").val()+"&box="+boxs,async:false,dataType:"json",success:function(data){var discountPrice=$("#discount").val();var amount=$("#amount").val();var pointSet=$("#pointSet").val();var zhekou=amount*pointSet/10;$("#yh").html("-￥"+data+".00");$("#youhui").val(data);var sumPrice=$("#sumPrice").val();var sum=Subtr(Subtr(sumPrice,data),discountPrice);var lastpay=sum;if(zhekou!=0){lastpay=lastpay-zhekou}$("#lastpay").html("￥"+lastpay);$("#lastpays").html("￥"+lastpay);if(data==0){$(".us").html("0")}else{$(".us").html("1")}$(".up").html(data);var sum=$("#lastpay").html();if(sum<1){$("#lastpay").html("￥"+"0.01")}if(data==0){$("#errorTips").html("请输入正确且未使用的优惠券")}else{$("#errorTips").html("")}}})}function jifen(){var flag=true;var sum=$("#sumPrice").val();var bosssum=$("#bosssumPrice").val();
    var pointSet=$("#pointSet").val();var amount=$("#amount").val();var customerPoint=$("#jifen1").val();var keyongSumPoint=$("#jifen2").val();var zhekou=amount*pointSet/10;var youhui=$("#youhui").val();var hydiscount=$("#discount").val();var zhekoujiage=Subtr(Subtr(Subtr(sum,zhekou),youhui),hydiscount);var muqianjifen=Subtr(customerPoint,amount);var muqiankeyongjf=Subtr(keyongSumPoint,amount);if($("#isOpen").val()=="1"){if(amount==""||amount==null){return}else{if(bosssum<1){flag=false;$("#tishi").html("注：目前订单金额不支持使用积分兑换功能!");$("#amount").val("")}else{if(parseInt(amount)>10000){flag=false;$("#tishi").html("注：亲积分每次使用最多不可以超过10000！");$("#amount").val("")}else{if(parseInt(customerPoint)<parseInt(amount)){flag=false;$("#tishi").html("注：亲您没有那么多可用积分！");$("#amount").val("")}else{if(amount%10!=0){flag=false;$("#tishi").html("注：兑换的积分必须为10的倍数!");$("#amount").val("")}else{if(zhekou>bosssum){flag=false;var keyishiyong=accDiv(accMul(bosssum,10),pointSet);keyishiyong=parseInt(parseInt(accDiv(parseInt(keyishiyong),10))+"0");$("#tishi").html("注：此次订单价格最多可以使用【"+keyishiyong+"】的积分！</span>");$("#amount").val("")}else{$("#muqianjifen").html(muqianjifen);$("#muqianjifen1").html(muqiankeyongjf);var jifenString=zhekoujiage.toString();var zheKouString=zhekou.toString();if(jifenString.indexOf(".")<0){$("#lastpay").html("￥"+zhekoujiage+".00");$("#lastpays").html("￥"+zhekoujiage+".00");$("#payPrice").val(zhekoujiage+".00")}else{if(jifenString.length-jifenString.indexOf(".")==1){$("#lastpay").html("￥"+zhekoujiage+"0");$("#lastpays").html("￥"+zhekoujiage+"0");$("#payPrice").val(zhekoujiage+"0")}else{if(jifenString.length-jifenString.indexOf(".")>2){$("#lastpay").html("￥"+(zhekoujiage+"").substr(0,jifenString.indexOf(".")+3));$("#lastpays").html("￥"+(zhekoujiage+"").substr(0,jifenString.indexOf(".")+3));$("#payPrice").val((zhekoujiage+"").substr(0,jifenString.indexOf(".")+3))}else{$("#lastpay").html("￥"+zhekoujiage);$("#lastpays").html("￥"+zhekoujiage);$("#payPrice").val(zhekoujiage)}}}if(zheKouString.indexOf(".")<0){zheKouString=zheKouString+".00"}else{if(zheKouString.length-zheKouString.indexOf(".")==1){zheKouString=zheKouString+"0"}else{if(zheKouString.length-zheKouString.indexOf(".")>2){zheKouString=(zheKouString+"").substr(0,zheKouString.indexOf(".")+3)}else{zheKouString=zheKouString}}}$("#jf").html("-￥"+zheKouString);$("#tishi").html("")}}}}}}}else{$("#tishi").html("注：不允许使用积分兑换金额,如有疑问请联系客服!");$("#amount").val("");return}return flag}function updateadd(count){if(count>5){$(".consignee-cont").css("height","210px");$(".addr-up").show();$(".addr-down").show()}else{$(".consignee-cont, .cust_allAddress").css("height","auto");$(".addr-up").hide();$(".addr-down").hide()}};